<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Answer Reveal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Discourage indexing -->
  <meta name="robots" content="noindex, nofollow" />
  <style>
    :root { color-scheme: light dark; --bg:#0b0b0b; --fg:#f5f5f5; --muted:#888; --brand:#4f7cff;}
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; }
    main { max-width: 720px; margin: 0 auto; padding: 24px; }
    header { margin: 8px 0 20px; }
    h1 { font-size: clamp(22px, 5vw, 30px); margin: 0 0 6px; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 18px; }
    form { display: grid; gap: 12px; }
    label { font-weight: 600; }
    input[type="text"], input[type="email"] { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #bbb; font-size: 16px; }
    button { background: var(--brand); color: white; border: 0; padding: 12px 16px; border-radius: 8px; font-weight: 700; cursor: pointer; }
    button:disabled { opacity: .7; cursor: wait; }
    .muted { color: var(--muted); font-size: 0.95rem; }
    .error { color: #b00020; }
    .answer { font-size: 1.25rem; line-height: 1.4; }
    .hidden { display: none !important; }
    footer { margin-top: 24px; font-size: .9rem; color: var(--muted); }
    .pill { color:#333; background:#f4f7ff; border:1px solid #dae4ff; padding:4px 8px; border-radius:999px; }
  </style>
</head>
<body>
<main>
  <header>
    <!-- No puzzle tag here, to avoid revealing anything prior to the gate -->
    <h1>Answer Reveal</h1>
    <p class="muted">Scan the QR code for each puzzle to see that puzzle’s answer.</p>
  </header>

  <!-- Gate (first-time form) -->
  <section id="gate" class="card">
    <h2>Tell us who you are (one-time)</h2>

    <!-- WHY line (requested wording) -->
    <p class="muted">
      Your name and email let us reveal the answer and keep your experience seamless on this device.
    </p>

    <form id="gateForm" method="POST" novalidate>
      <input type="hidden" name="_subject" value="Puzzle Answer Access" />
      <input type="hidden" id="puzzleIdField" name="puzzle_id" />
      <!-- Optional tagging to help segment in your inbox/integrations -->
      <input type="hidden" name="tags" value="PuzzleBook2025,AnswerGate" />

      <!-- Honeypot (leave blank) -->
      <div class="hidden">
        <label>Do not fill this field</label>
        <input type="text" name="website" tabindex="-1" autocomplete="off" />
      </div>

      <div>
        <label for="name">Your Name</label>
        <input id="name" name="name" type="text" autocomplete="name" required />
      </div>

      <div>
        <label for="email">Your Email</label>
        <input id="email" name="email" type="email" autocomplete="email" required />
      </div>

      <!-- Optional marketing opt-in (unchecked by default) -->
      <label class="muted" style="display:flex; gap:.5rem; align-items:flex-start; margin-top:.25rem;">
        <input type="checkbox" name="subscribe" value="yes" />
        <span>Keep me posted about new puzzle books and bonus content (occasional emails).</span>
      </label>

      <button id="submitBtn" type="submit">Reveal This Answer</button>
      <div id="formMsg" class="muted" aria-live="polite"></div>
      <div id="formErr" class="error"></div>

      <!-- Friendlier reminder line (requested wording) -->
      <p class="muted" style="margin-top:.5rem;">
        You’ll only need to provide your details once on this device.
      </p>

      <!-- Compact privacy notice (collapsible) -->
      <details class="muted" style="margin-top:.25rem;">
        <summary>Privacy notice</summary>
        <p style="margin:.5rem 0 0;">
          We use your name and email to provide the answer and avoid repeated prompts on this device. If you opt in, we may email you about new puzzle books or to request feedback. You can unsubscribe anytime using the link in our emails. We don’t sell your data.
        </p>
      </details>
    </form>
  </section>

  <!-- Answer (only after access) -->
  <section id="answer" class="card hidden" aria-live="polite">
    <h2 id="puzzleTitle">Answer</h2>
    <p class="answer">
      <strong>Character:</strong> <span id="character"></span><br />
      <strong>Portrayed by:</strong> <span id="actor"></span>
    </p>
    <p class="muted">
      Seeing this on a shared device? <button class="pill" id="resetBtn" type="button">Not me – clear access</button>
    </p>
  </section>

  <!-- Footer is optional. You can remove the entire footer block if you prefer. -->
  <footer>
    <p class="muted">© 2025 Global Publishers</p>
  </footer>
</main>

<script>
/** ============
 *  CONFIG
 *  ============
 */

// Your Formspree endpoint (unchanged)
const FORM_ENDPOINT = "https://formspree.io/f/xrbljyyn";

// Numeric puzzle IDs (1–40). Nothing shows until after access is granted.
const PUZZLES = {
  "1":  { title: "Puzzle #01", character: "Iron Man (Tony Stark)",                     actor: "Robert Downey Jr." },
  "2":  { title: "Puzzle #02", character: "Captain America (Steve Rogers)",            actor: "Chris Evans" },
  "3":  { title: "Puzzle #03", character: "Thor",                                      actor: "Chris Hemsworth" },
  "4":  { title: "Puzzle #04", character: "Hulk (Bruce Banner)",                       actor: "Mark Ruffalo" },
  "5":  { title: "Puzzle #05", character: "Black Widow (Natasha Romanoff)",            actor: "Scarlett Johansson" },
  "6":  { title: "Puzzle #06", character: "Hawkeye (Clint Barton)",                    actor: "Jeremy Renner" },
  "7":  { title: "Puzzle #07", character: "Spider-Man (Peter Parker)",                 actor: "Tom Holland" },
  "8":  { title: "Puzzle #08", character: "Black Panther (T’Challa)",                  actor: "Chadwick Boseman" },
  "9":  { title: "Puzzle #09", character: "Doctor Strange (Stephen Strange)",          actor: "Benedict Cumberbatch" },
  "10": { title: "Puzzle #10", character: "Captain Marvel (Carol Danvers)",            actor: "Brie Larson" },
  "11": { title: "Puzzle #11", character: "Ant-Man (Scott Lang)",                      actor: "Paul Rudd" },
  "12": { title: "Puzzle #12", character: "The Wasp (Hope van Dyne)",                  actor: "Evangeline Lilly" },
  "13": { title: "Puzzle #13", character: "Scarlet Witch (Wanda Maximoff)",            actor: "Elizabeth Olsen" },
  "14": { title: "Puzzle #14", character: "Vision",                                    actor: "Paul Bettany" },
  "15": { title: "Puzzle #15", character: "Star-Lord (Peter Quill)",                   actor: "Chris Pratt" },
  "16": { title: "Puzzle #16", character: "Gamora",                                    actor: "Zoe Saldana" },
  "17": { title: "Puzzle #17", character: "Drax",                                      actor: "Dave Bautista" },
  "18": { title: "Puzzle #18", character: "Rocket",                                    actor: "Bradley Cooper" },
  "19": { title: "Puzzle #19", character: "Groot",                                     actor: "Vin Diesel" },
  "20": { title: "Puzzle #20", character: "Falcon (Sam Wilson)",                       actor: "Anthony Mackie" },
  "21": { title: "Puzzle #21", character: "Winter Soldier (Bucky Barnes)",             actor: "Sebastian Stan" },
  "22": { title: "Puzzle #22", character: "War Machine (James Rhodes)",                actor: "Don Cheadle" },
  "23": { title: "Puzzle #23", character: "Okoye",                                     actor: "Danai Gurira" },
  "24": { title: "Puzzle #24", character: "Shuri",                                     actor: "Letitia Wright" },
  "25": { title: "Puzzle #25", character: "Mantis",                                    actor: "Pom Klementieff" },
  "26": { title: "Puzzle #26", character: "Valkyrie",                                  actor: "Tessa Thompson" },
  "27": { title: "Puzzle #27", character: "Wong",                                      actor: "Benedict Wong" },
  "28": { title: "Puzzle #28", character: "Nebula",                                    actor: "Karen Gillan" },
  "29": { title: "Puzzle #29", character: "Kate Bishop",                               actor: "Hailee Steinfeld" },
  "30": { title: "Puzzle #30", character: "Yelena Belova",                             actor: "Florence Pugh" },
  "31": { title: "Puzzle #31", character: "Thanos",                                    actor: "Josh Brolin" },
  "32": { title: "Puzzle #32", character: "Loki",                                      actor: "Tom Hiddleston" },
  "33": { title: "Puzzle #33", character: "Hela",                                      actor: "Cate Blanchett" },
  "34": { title: "Puzzle #34", character: "Erik Killmonger (Erik Stevens)",            actor: "Michael B. Jordan" },
  "35": { title: "Puzzle #35", character: "Ultron",                                    actor: "James Spader" },
  "36": { title: "Puzzle #36", character: "Red Skull (Johann Schmidt)",                actor: "Hugo Weaving" },
  "37": { title: "Puzzle #37", character: "Ronan the Accuser",                         actor: "Lee Pace" },
  "38": { title: "Puzzle #38", character: "Taskmaster",                                actor: "Olga Kurylenko" },
  "39": { title: "Puzzle #39", character: "Mysterio (Quentin Beck)",                   actor: "Jake Gyllenhaal" },
  "40": { title: "Puzzle #40", character: "Agatha Harkness",                           actor: "Kathryn Hahn" }
};

// localStorage key used to remember the one-time gate
const ACCESS_KEY = "puzzlebook_player_v1";

/** ============
 *  HELPERS
 *  ============
 */
const $ = (id) => document.getElementById(id);

function getPuzzleId() {
  const url = new URL(window.location.href);
  // prefer '?p=' param; fallback to '#'
  return url.searchParams.get("p") || (window.location.hash ? window.location.hash.substring(1) : "");
}

function validEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(email).trim());
}

function hasAccess() {
  try {
    const raw = localStorage.getItem(ACCESS_KEY);
    if (!raw) return false;
    const obj = JSON.parse(raw);
    return !!(obj && obj.email);
  } catch {
    return false;
  }
}

function grantAccess(name, email) {
  localStorage.setItem(ACCESS_KEY, JSON.stringify({ name, email, ts: Date.now() }));
}

function revokeAccess() {
  localStorage.removeItem(ACCESS_KEY);
  location.reload();
}

/** ============
 *  INIT
 *  ============
 */
const puzzleId = getPuzzleId();
const puzzle = PUZZLES[puzzleId];

(function init() {
  if (!puzzleId || !puzzle) {
    // Invalid/missing id: show a neutral message, no spoilers
    $("gate").classList.add("hidden");
    $("answer").classList.remove("hidden");
    $("puzzleTitle").textContent = "Invalid or missing puzzle link";
    $("character").textContent   = "—";
    $("actor").textContent       = "—";
    return;
  }

  // Do not set any puzzle-specific text yet; keep everything neutral until access is granted
  $("puzzleIdField").value = puzzleId;

  if (hasAccess()) {
    renderAnswer(puzzle);
  } else {
    wireForm();
  }

  $("resetBtn").addEventListener("click", revokeAccess);
})();

function renderAnswer(puz) {
  $("gate").classList.add("hidden");
  $("answer").classList.remove("hidden");
  // Only now do we reveal puzzle info
  $("puzzleTitle").textContent = puz.title;
  $("character").textContent   = puz.character;
  $("actor").textContent       = puz.actor;
}

function wireForm() {
  const form = $("gateForm");
  const submitBtn = $("submitBtn");
  const msg = $("formMsg");
  const err = $("formErr");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    err.textContent = "";
    msg.textContent = "";

    const name  = $("name").value.trim();
    const email = $("email").value.trim();

    if (!name)  { err.textContent = "Please enter your name."; return; }
    if (!email || !validEmail(email)) { err.textContent = "Please enter a valid email."; return; }

    submitBtn.disabled = true;
    msg.textContent = "Submitting…";

    try {
      const fd = new FormData(form);
      const res = await fetch(FORM_ENDPOINT, {
        method: "POST",
        body: fd,
        headers: { "Accept": "application/json" }
      });

      if (res.ok) {
        grantAccess(name, email);
        renderAnswer(puzzle);
      } else {
        err.textContent = "Oops! There was a problem submitting the form.";
      }
    } catch {
      err.textContent = "Network error. Please try again.";
    } finally {
      submitBtn.disabled = false;
      msg.textContent = "";
    }
  });
}
</script>
</body>
</html>
